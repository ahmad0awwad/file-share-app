(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[457],{547:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d});var r=s(5155),a=s(2115),l=s(4298);function n(e){let{users:t,currentUser:s,activeUser:a,unread:l,onSelectUser:n}=e;return(0,r.jsx)("aside",{className:"w-20 bg-white shadow-lg p-3 flex flex-col gap-4 overflow-y-auto",children:t.map(e=>e===s?null:(0,r.jsxs)("div",{className:"relative cursor-pointer",onClick:()=>n(e),title:e,children:[(0,r.jsx)("img",{src:"https://i.pravatar.cc/150?u=".concat(e),alt:e,className:"w-12 h-12 object-cover rounded-full ".concat(a===e?"ring-2 ring-blue-500":"")}),l[e]>0&&(0,r.jsx)("div",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full px-1",children:l[e]})]},e))})}var i=s(470);function c(e){var t;let{message:s}=e,a="me"===s.sender;return null===(t=s.fileUrl)||void 0===t||t.split("/").pop(),"video"===s.fileType||"pdf"===s.fileType||s.fileType,(0,r.jsx)(i.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:"flex ".concat(a?"justify-end":"justify-start"),children:(0,r.jsxs)("div",{className:"max-w-[80%] p-3 rounded-2xl shadow text-sm relative ".concat(a?"bg-green-200 rounded-br-none":"bg-white rounded-bl-none"),children:[s.text&&(0,r.jsx)("p",{children:s.text}),s.fileUrl&&(0,r.jsx)("div",{className:"mt-2",children:"image"===s.fileType?(0,r.jsx)("img",{src:s.fileUrl,className:"rounded max-w-full h-auto"}):(0,r.jsx)("a",{href:"http://localhost:1000".concat(s.fileUrl),download:!0,target:"_blank",rel:"noreferrer",className:"inline-flex items-center gap-2 text-blue-600 hover:underline text-sm",children:"\uD83D\uDCE5 Download File"})}),(0,r.jsxs)("div",{className:"text-[10px] text-gray-500 text-right mt-1",children:[s.time," ",a&&s.read?"✅✅":a?"✅":""]})]})})}function o(e){let{onSend:t}=e,s=(0,a.useRef)(null);return(0,r.jsxs)("div",{className:"p-3 border-t bg-white flex gap-2 items-center",onDrop:e=>{e.preventDefault(),t("",Array.from(e.dataTransfer.files))},onDragOver:e=>e.preventDefault(),children:[(0,r.jsx)("input",{type:"text",ref:s,placeholder:"Type a message",className:"flex-1 border rounded-full px-4 py-2 text-sm",onKeyDown:e=>{var r;"Enter"===e.key&&(null===(r=s.current)||void 0===r?void 0:r.value)&&(t(s.current.value,[]),s.current.value="")}}),(0,r.jsx)("label",{htmlFor:"fileInput",className:"cursor-pointer text-blue-600 text-lg",children:"\uD83D\uDCCE"}),(0,r.jsx)("input",{id:"fileInput",type:"file",className:"hidden",multiple:!0,onChange:e=>{t("",Array.from(e.target.files||[]))}})]})}let u=(0,l.Ay)("http://localhost:1000");function d(){let[e,t]=(0,a.useState)(null),[s,l]=(0,a.useState)(""),[i,d]=(0,a.useState)({}),[m,p]=(0,a.useState)([]),f=(0,a.useRef)(null);(0,a.useEffect)(()=>{let e=localStorage.getItem("user");if(e){let s=JSON.parse(e);t(s),u.emit("join",s.username);let r=["user1","user2","user3","user4","user5","user6"].filter(e=>e!==s.username);r.length>0&&l(r[0])}},[]),(0,a.useEffect)(()=>{e&&s&&x()},[s,e]);let x=async()=>{let t=await fetch("http://localhost:1000/api/messages/".concat(e.username,"/").concat(s));p((await t.json()).messages||[]),g()};(0,a.useEffect)(()=>{let t=t=>{t.sender===s&&t.receiver===(null==e?void 0:e.username)||t.sender===(null==e?void 0:e.username)&&t.receiver===s?(p(e=>[...e,t]),g()):d(e=>({...e,[t.sender]:(e[t.sender]||0)+1}))};return u.on("newMessage",t),()=>{u.off("newMessage",t)}},[s,e]);let h=async(t,r)=>{let a=new FormData;a.append("sender",e.username),a.append("receiver",s),t&&a.append("text",t),r[0]&&a.append("file",r[0]);let l=await fetch("http://localhost:1000/api/message",{method:"POST",body:a}),n=await l.json();p(e=>[...e,n.msg]),g()},g=()=>{var e;null===(e=f.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})};return(0,r.jsxs)("div",{className:"flex h-screen bg-gray-100",children:[e&&(0,r.jsx)(n,{users:["user1","user2","user3","user4","user5","user6"],currentUser:e.username,activeUser:s,unread:i,onSelectUser:e=>{l(e),d(t=>({...t,[e]:0}))}}),(0,r.jsxs)("main",{className:"flex-1 flex flex-col",children:[(0,r.jsxs)("div",{className:"p-4 border-b bg-white flex items-center",children:[(0,r.jsx)("img",{src:"https://i.pravatar.cc/150?u=".concat(s),className:"w-10 h-10 rounded-full mr-3",alt:""}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-lg font-semibold",children:s}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"online"})]})]}),(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",style:{backgroundImage:'url("/chat-bg.png")',backgroundRepeat:"repeat",backgroundSize:"auto"},children:[m.map(e=>(0,r.jsx)(c,{message:e},e._id||e.timestamp||Math.random())),(0,r.jsx)("div",{ref:f})]}),(0,r.jsx)(o,{onSend:h})]})]})}},8950:(e,t,s)=>{Promise.resolve().then(s.bind(s,547))}},e=>{var t=t=>e(e.s=t);e.O(0,[357,441,684,358],()=>t(8950)),_N_E=e.O()}]);